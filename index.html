<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>聊天室</title>
        <script src="/socket.io/socket.io.js"></script>
    </head>
    <body>
        <button id="id-login" name="button">登录</button>
        <button id="id-logout" name="button">登出</button>
        <button id="id-send-message" name="button">发送消息</button>
        <br>
        <textarea id="my-textarea"></textarea>

        <script type="text/javascript">
            var logIn = function() {
                var logIn = document.querySelector('#id-login')
                logIn.addEventListener('click', function() {
                    var socket = io.connect()
                    socket.on('connect', function() {
                        console.log('链接成功')
                    })
                    socket.on('whoAreYou', () => {
                        var name = prompt("输入你得名字", "")
                        socket.emit('name', name)
                    })
                    socket.on('message', function(msg) {
                        console.log(msg)
                    })
                    sendMsg(socket)
                    logOut(socket)
                })
            }
            var sendMsg = function(socket) {
                var sendBtn = document.querySelector('#id-send-message')
                sendBtn.addEventListener('click', function() {
                    var msg = document.querySelector('#my-textarea').value
                    socket.emit('message', msg)
                })
            }
            var logOut = function(socket) {
                var logOut = document.querySelector('#id-logout')
                logOut.addEventListener('click', function() {
                    socket.disconnect()
                })
            }
            logIn()
        </script>
    </body>
</html>
